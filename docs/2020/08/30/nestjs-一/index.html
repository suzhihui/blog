<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>nestjs(一) | 日不新，则日退</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="基础介绍 1、Nest基于TypeScript编写并且结合了 OOP(面向对象编程)，FP(函数式编程)和 FRP (函数式响应编程)的相关理念。在设计上的很多灵感来自于 Angular，Angular 的很多模 式又来自于 Java 中的 Spring 框架，依赖注入、面向切面编程等，所以我们也可以认为: Nest 是 Node.js 版的 Spring 框架 2、Nest 框架底层 HTTP">
<meta property="og:type" content="article">
<meta property="og:title" content="nestjs(一)">
<meta property="og:url" content="https://suzhihui.github.io/2020/08/30/nestjs-%E4%B8%80/index.html">
<meta property="og:site_name" content="日不新，则日退">
<meta property="og:description" content="基础介绍 1、Nest基于TypeScript编写并且结合了 OOP(面向对象编程)，FP(函数式编程)和 FRP (函数式响应编程)的相关理念。在设计上的很多灵感来自于 Angular，Angular 的很多模 式又来自于 Java 中的 Spring 框架，依赖注入、面向切面编程等，所以我们也可以认为: Nest 是 Node.js 版的 Spring 框架 2、Nest 框架底层 HTTP">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://images.gitee.com/uploads/images/2020/0829/191742_a80102c9_1808543.png">
<meta property="og:image" content="https://images.gitee.com/uploads/images/2020/0829/191807_440763ce_1808543.png">
<meta property="og:image" content="https://images.gitee.com/uploads/images/2020/0829/191823_37b669a3_1808543.jpeg">
<meta property="og:image" content="https://images.gitee.com/uploads/images/2020/0829/192116_f79f4fb6_1808543.png">
<meta property="og:image" content="https://images.gitee.com/uploads/images/2020/0829/192027_4708ffc5_1808543.png">
<meta property="og:image" content="https://images.gitee.com/uploads/images/2020/0829/192049_cbee883e_1808543.png">
<meta property="article:published_time" content="2020-08-30T14:54:42.000Z">
<meta property="article:modified_time" content="2020-08-31T04:25:08.200Z">
<meta property="article:author" content="laosu">
<meta property="article:tag" content="nestjs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.gitee.com/uploads/images/2020/0829/191742_a80102c9_1808543.png">
  
    <link rel="alternate" href="/atom.xml" title="日不新，则日退" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">日不新，则日退</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">海纳百川</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://suzhihui.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-nestjs-一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/30/nestjs-%E4%B8%80/" class="article-date">
  <time datetime="2020-08-30T14:54:42.000Z" itemprop="datePublished">2020-08-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      nestjs(一)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="基础介绍"><a href="#基础介绍" class="headerlink" title="基础介绍"></a>基础介绍</h1><ul>
<li>1、Nest基于TypeScript编写并且结合了 OOP(面向对象编程)，FP(函数式编程)和 FRP (函数式响应编程)的相关理念。在设计上的很多灵感来自于 Angular，Angular 的很多模 式又来自于 Java 中的 Spring 框架，依赖注入、面向切面编程等，所以我们也可以认为: Nest 是 Node.js 版的 Spring 框架</li>
<li>2、Nest 框架底层 HTTP 平台默认是基于 Express 实现的，所以无需担心第三方库的缺失。 Nest 旨在成为一个与平台无关的框架</li>
</ul>
<h2 id="为什么要使用脚手架"><a href="#为什么要使用脚手架" class="headerlink" title="为什么要使用脚手架"></a>为什么要使用脚手架</h2><blockquote>
<p>关于这个问题,其实我们在现代前端开发中，你使用vue,react等项目开发中,我们都会使用官方推荐的脚手架(所谓的xx-cli工具)来生成项目,这样的好处在于:</p>
</blockquote>
<ul>
<li>减少时间，不必从零开始搭建初始项目，提高开发效率。</li>
<li>便于多人协作</li>
<li>项目更新同步方便，只需要更新代码库中项目模板，即可下载最新的项目</li>
</ul>
<h1 id="脚手架的安装及常见的命令"><a href="#脚手架的安装及常见的命令" class="headerlink" title="脚手架的安装及常见的命令"></a>脚手架的安装及常见的命令</h1><h2 id="一、官网地址"><a href="#一、官网地址" class="headerlink" title="一、官网地址"></a>一、<a href="https://docs.nestjs.com/cli/overview" target="_blank" rel="noopener">官网地址</a></h2><h2 id="nest-cli的基本使用"><a href="#nest-cli的基本使用" class="headerlink" title="nest-cli的基本使用"></a><code>nest-cli</code>的基本使用</h2><ul>
<li><p>1、安装脚手架</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @nestjs/cli</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、查看脚手架的版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nest -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、查看全部的命令(不记得使用命令创建文件的时候可以使用)</p>
<blockquote>
<p>根据下面打星多少来表示项目开中使用频率</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">nest-book git:(master) nest   # 输入的命令</span><br><span class="line">Usage: nest &lt;command&gt; [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -v, --version                                   查看当前nestjs-cli的版本</span><br><span class="line">  -h, --help                                      查看帮助</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  new|n [options] [name]                          生成一个新的项目</span><br><span class="line">  build [options] [app]                           构建一个项目</span><br><span class="line">  start [options] [app]                           运行项目</span><br><span class="line">  info|i                                          显示项目的具体信息</span><br><span class="line">  update|u [options]                              升级之前的依赖包</span><br><span class="line">  add [options] &lt;library&gt;                         将对外部库的支持添加到项目中。</span><br><span class="line"></span><br><span class="line">  generate|g [options] &lt;schematic&gt; [name] [path]  Generate a Nest element.</span><br><span class="line">    Available schematics:</span><br><span class="line">      全称              别名(一般我们使用别名就可以)</span><br><span class="line">      ┌───────────────┬─────────────┐</span><br><span class="line">      │ name          │ alias       │</span><br><span class="line">      │ application   │ application │</span><br><span class="line">      │ class         │ cl          │</span><br><span class="line">      │ configuration │ config      │</span><br><span class="line">      │ controller    │ co          │            ** 控制器</span><br><span class="line">      │ decorator     │ d           │            * 装饰器</span><br><span class="line">      │ filter        │ f           │            * 过滤器</span><br><span class="line">      │ gateway       │ ga          │            网关</span><br><span class="line">      │ guard         │ gu          │            * 守卫</span><br><span class="line">      │ interceptor   │ in          │            * 拦截器</span><br><span class="line">      │ interface     │ interface   │            接口</span><br><span class="line">      │ middleware    │ mi          │            中间层  </span><br><span class="line">      │ module        │ mo          │            ** 模块</span><br><span class="line">      │ pipe          │ pi          │            * 管道</span><br><span class="line">      │ provider      │ pr          │</span><br><span class="line">      │ resolver      │ r           │            graphql使用相当于上面的控制器</span><br><span class="line">      │ service       │ s           │            ** 创建服务</span><br><span class="line">      │ library       │ lib         │</span><br><span class="line">      │ sub-app       │ app         │</span><br><span class="line">      └───────────────┴─────────────┘</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、使用脚手架命令创建文件(控制器、服务层、模块)的时候会自动生成一个<code>spec</code>的测试文件,如果不想需要,可以加上参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nest g mo user [--no-spec]</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、创建一个<code>module</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nest g mo user</span><br></pre></td></tr></table></figure>
</li>
<li><p>6、创建一个控制器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nest g co user</span><br><span class="line">nest g co user --no-spec # 创建不带测试文件的</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建的会自动更新到user.module中(前提是你先创建了module)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>7、创建一个服务层</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nest g s user</span><br></pre></td></tr></table></figure>

<h1 id="使用脚手架构建一个新的项目"><a href="#使用脚手架构建一个新的项目" class="headerlink" title="使用脚手架构建一个新的项目"></a>使用脚手架构建一个新的项目</h1><h1 id="使用脚手架构建一个项目"><a href="#使用脚手架构建一个项目" class="headerlink" title="使用脚手架构建一个项目"></a><center>使用脚手架构建一个项目</center></h1></li>
</ul>
<h2 id="一、项目基本介绍"><a href="#一、项目基本介绍" class="headerlink" title="一、项目基本介绍"></a>一、项目基本介绍</h2><ul>
<li><p>1、使用脚手架创建一个项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nest new nest-base</span><br></pre></td></tr></table></figure>

<blockquote>
<p>选择安装依赖包的方式后就耐心等待</p>
</blockquote>
<p><img src="https://images.gitee.com/uploads/images/2020/0829/191742_a80102c9_1808543.png" alt="输入图片说明" title="image-20200713153707891.png"></p>
</li>
<li><p>2、初始化项目文件介绍(删除<code>node_module</code>后的项目)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜  nest-base git:(master) tree</span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── nest-cli.json # nest-cli的配置</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── package.json</span><br><span class="line">├── src  # 项目文件</span><br><span class="line">│   ├── app.controller.spec.ts # 控制器的单元测试文件(可以删除)</span><br><span class="line">│   ├── app.controller.ts # 控制器文件(可以删除)</span><br><span class="line">│   ├── app.module.ts # 入口的module(不能删除)</span><br><span class="line">│   ├── app.service.ts # 服务层文件(可以删除)</span><br><span class="line">│   └── main.ts # 项目入口文件(不能删除)</span><br><span class="line">├── test # 测试文件(可以删除)</span><br><span class="line">│   ├── app.e2e-spec.ts</span><br><span class="line">│   └── jest-e2e.json</span><br><span class="line">├── tsconfig.build.json</span><br><span class="line">└── tsconfig.json # tsconfig的配置文件</span><br><span class="line"></span><br><span class="line">2 directories, 13 files</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="二、关于nestjs项目架构"><a href="#二、关于nestjs项目架构" class="headerlink" title="二、关于nestjs项目架构"></a>二、关于<code>nestjs</code>项目架构</h2><ul>
<li><p>1、官网提供的架构图</p>
<p><img src="https://images.gitee.com/uploads/images/2020/0829/191807_440763ce_1808543.png" alt="输入图片说明" title="nestjs01.png"></p>
<p>图中表述的意思:</p>
<ul>
<li>我们可以在项目中定义很多控制层</li>
<li>客户端(浏览器、移动设备)发送<code>http</code>请求,根据<code>url</code>匹配的原则,到对应的控制器</li>
<li>控制器继续访问到服务层</li>
<li>服务层对接数据层,然后对数据的增删改查</li>
</ul>
</li>
<li><p>2、实际中我们构建大型项目的时候的架构</p>
<p><img src="https://images.gitee.com/uploads/images/2020/0829/191823_37b669a3_1808543.jpeg" alt="输入图片说明" title="nestjs02.jpg"></p>
</li>
</ul>
<h2 id="三、基础项目的解释"><a href="#三、基础项目的解释" class="headerlink" title="三、基础项目的解释"></a>三、基础项目的解释</h2><ul>
<li><p>1、目录结构</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  src git:(master) tree</span><br><span class="line">.</span><br><span class="line">├── app.controller.spec.ts # 测试文件，可以先不看</span><br><span class="line">├── app.controller.ts # 控制器</span><br><span class="line">├── app.module.ts # 主模块</span><br><span class="line">├── app.service.ts # 服务层</span><br><span class="line">└── main.ts # 入口文件</span><br><span class="line"></span><br><span class="line">0 directories, 5 files</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、<code>main.ts</code>文件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NestFactory &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppModule &#125; <span class="keyword">from</span> <span class="string">'./app.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 使用NestFactory工厂创建一个app应用并且传递一个AppModule模块进去,类似我们使用express框架一样的先创建一个app</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule);</span><br><span class="line">  <span class="comment">// 监控端口,运行项目后浏览器直接访问localhost:3000</span></span><br><span class="line">  <span class="keyword">await</span> app.listen(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line">bootstrap();</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、<code>app.module.ts</code>文件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppController &#125; <span class="keyword">from</span> <span class="string">'./app.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppService &#125; <span class="keyword">from</span> <span class="string">'./app.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [], <span class="comment">// 依赖外面的模块(可以是自己创建的比如userModule，或者是官方提供的比如typeorm, graphql,或者第三方的)</span></span><br><span class="line">  controllers: [AppController], <span class="comment">// 该模块所用到的控制器</span></span><br><span class="line">  providers: [AppService], <span class="comment">// 该模块的提供者</span></span><br><span class="line">  exports: [], <span class="comment">// 别的模块要使用该模块中的某几个方法，就要在这里对外暴漏</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、<code>app.controller.ts</code>文件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppService &#125; <span class="keyword">from</span> <span class="string">'./app.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>() <span class="comment">// 使用nestjs的装饰器装饰表示该类是一个控制器</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppController &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="comment">// 使用依赖注入的方式注入一个类</span></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> readonly appService: AppService</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>() <span class="comment">// 定义http的请求方式为get请求</span></span><br><span class="line">  getHello(): <span class="built_in">string</span> &#123; <span class="comment">// 函数名可以随便定义</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.appService.getHello(); <span class="comment">// 控制层调用服务层的getHello()方法</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、<code>app.service.ts</code>文件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppService &#123;</span><br><span class="line">  getHello(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="comment">// 现在直接返回一个字符串,实际开发中这里调用typeorm中的方法对数据库进行curd操作</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="依赖注入的概念"><a href="#依赖注入的概念" class="headerlink" title="依赖注入的概念"></a>依赖注入的概念</h1><h2 id="一、依赖注入的概念"><a href="#一、依赖注入的概念" class="headerlink" title="一、依赖注入的概念"></a>一、依赖注入的概念</h2></li>
<li><p>1、依赖注入的概念</p>
<blockquote>
<p>依赖注入(<code>DI</code>)是用来创建对象及其依赖的其它对象的一种方式。 当依赖注入系统创建某个对象实例时，会负责提供该对象所依赖的对象(称为该对象的依赖)。思想来源于<code>angular</code></p>
</blockquote>
</li>
<li><p>2、服务提供上<code>@Injectable</code><br><code>@Injectable</code>装饰器会指出这些服务或其它类是用来注入的(比如一些工具方法)。它还能用于为这些服务提供配置项。</p>
</li>
</ul>
<h2 id="二、常见的定义提供器的方式【代码见01-di分支】"><a href="#二、常见的定义提供器的方式【代码见01-di分支】" class="headerlink" title="二、常见的定义提供器的方式【代码见01.di分支】"></a>二、常见的定义提供器的方式【<a href="https://github.com/kuangshp/nest-book-code/tree/01.di/nest-base" target="_blank" rel="noopener">代码见01.di分支</a>】</h2><ul>
<li><p>1、基本方式(<font color="#f00"><b>也是最常见的</b></font>)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">providers: [AppService]</span><br><span class="line"><span class="comment">// 使用方式直接依赖注入就可以</span></span><br><span class="line"><span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="keyword">private</span> readonly appService: AppService,</span></span><br><span class="line"><span class="params"></span>) &#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、<code>uerClass</code>的方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">providers: [</span><br><span class="line">  &#123; </span><br><span class="line">    provide: AppService, </span><br><span class="line">    useClass: AppService </span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 使用方式直接依赖注入就可以</span></span><br><span class="line"><span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="keyword">private</span> readonly appService: AppService,</span></span><br><span class="line"><span class="params"></span>) &#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、<code>provide</code>定义字符串的方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">providers: [</span><br><span class="line">  AppService,</span><br><span class="line">  &#123;</span><br><span class="line">    provide: <span class="string">'LOG'</span>,</span><br><span class="line">    useClass: LoggerService</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line"><span class="comment">// 使用方式需要使用@Inject的方式</span></span><br><span class="line"><span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="keyword">private</span> readonly appService: AppService,</span></span><br><span class="line"><span class="params">  <span class="meta">@Inject</span>(<span class="string">'LOG'</span>) readonly loggerService: LoggerService</span></span><br><span class="line"><span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>()</span><br><span class="line">getHello(): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.loggerService.log(<span class="string">'日志'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.appService.getHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、使用<code>useFactory</code>工厂方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [],</span><br><span class="line">  controllers: [AppController],</span><br><span class="line">  providers: [</span><br><span class="line">    &#123;</span><br><span class="line">      provide: <span class="string">'LOG'</span>,</span><br><span class="line">      useClass: LoggerService</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      provide: <span class="string">'APP_SERVICE'</span>,</span><br><span class="line">      useFactory: <span class="function">(<span class="params">logger</span>) =&gt;</span> &#123;</span><br><span class="line">        logger.log(<span class="string">'使用工厂方式'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'工厂方法返回'</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      inject: [<span class="string">'LOG'</span>] <span class="comment">// 注入的顺序就是useFactory函数的顺序</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  exports: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line"><span class="meta">@Controller</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppController &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(<span class="string">'APP_SERVICE'</span>) readonly appService: AppService,</span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(<span class="string">'LOG'</span>) readonly loggerService: LoggerService</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  getHello(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.loggerService.log(<span class="string">'日志'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.appService);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'nestjs'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、使用<code>useValue</code>方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">providers: [</span><br><span class="line">  ...</span><br><span class="line">  &#123;</span><br><span class="line">    provide: <span class="string">'IS_DEV'</span>,</span><br><span class="line">    useValue: &#123; isDev: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="meta">@Controller</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppController &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(<span class="string">'IS_DEV'</span>) readonly isDev: &#123; isDev: <span class="built_in">boolean</span> &#125;,</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  getHello(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.isDev);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'nestjs'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="nestjs中模块的认识"><a href="#nestjs中模块的认识" class="headerlink" title="nestjs中模块的认识"></a>nestjs中模块的认识</h1><h2 id="一、官网地址-1"><a href="#一、官网地址-1" class="headerlink" title="一、官网地址"></a>一、<a href="https://docs.nestjs.com/modules" target="_blank" rel="noopener">官网地址</a></h2><h2 id="二、关于nestjs中module的认识"><a href="#二、关于nestjs中module的认识" class="headerlink" title="二、关于nestjs中module的认识"></a>二、关于<code>nestjs</code>中<code>module</code>的认识</h2><ul>
<li><p>1、在前面介绍到<code>nestjs</code>项目是由很多个<code>module</code>来组装成一个大项目的,类似现在前端框架是由很多的组件组装成一个项目。</p>
</li>
<li><p>2、来自官网介绍模块的图</p>
<p><img src="https://images.gitee.com/uploads/images/2020/0829/192116_f79f4fb6_1808543.png" alt="输入图片说明" title="module.png"></p>
<ul>
<li>一个项目只能有一个根模块<code>app.module.ts</code>这个模块</li>
<li>一个项目可以由多个模块组成</li>
<li>模块之间可以相互的引入</li>
</ul>
</li>
<li><p>3、模块的使用</p>
<ul>
<li>在<code>nestjs</code>中模块是使用<code>@Module</code>装饰器装饰的一个类</li>
<li>在<code>@Module</code>中可接收一个对象，用来描素该模块的功能</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>描素</th>
</tr>
</thead>
<tbody><tr>
<td><code>imports</code></td>
<td>该模块依赖其它的模块, 以数组的方式，表示可以多个</td>
</tr>
<tr>
<td><code>controllers</code></td>
<td>该模块在定义的控制器, 以数组的方式，表示可以多个</td>
</tr>
<tr>
<td><code>providers</code></td>
<td>为该模块提供功能的提供者, 以数组的方式，表示可以多个</td>
</tr>
<tr>
<td><code>exports</code></td>
<td>该模块需要对外暴漏出去给别的模板使用的功能, 以数组的方式，表示可以多个</td>
</tr>
</tbody></table>
<h2 id="三、自定义业务模块"><a href="#三、自定义业务模块" class="headerlink" title="三、自定义业务模块"></a>三、自定义业务模块</h2><ul>
<li><p>1、直接使用命令创建一个<code>module</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在modules的文件夹下创建一个用户模块</span></span><br><span class="line">nest g mo modules/user</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建后的提示语</span></span><br><span class="line">➜  nest-base git:(02.module) ✗ nest g mo modules/user</span><br><span class="line">CREATE src/modules/user/user.module.ts (81 bytes)  # 表示创建的文件所在的位置</span><br><span class="line">UPDATE src/app.module.ts (317 bytes) # 更新了那个文件(会自动在app.module.ts的import中引入当前创建的module)</span><br><span class="line">➜  nest-base git:(02.module) ✗</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、我们讲到可以在<code>module</code>中创建属于该<code>module</code>下面的控制器和服务层</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建不带测试文件的控制器</span></span><br><span class="line">➜  nest-base git:(02.module) ✗ nest g co modules/user --no-spec</span><br><span class="line">CREATE src/modules/user/user.controller.ts (97 bytes)</span><br><span class="line">UPDATE src/modules/user/user.module.ts (167 bytes)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建不带测试文件的服务层</span></span><br><span class="line">➜  nest-base git:(02.module) ✗ nest g s modules/user --no-spec         </span><br><span class="line">CREATE src/modules/user/user.service.ts (88 bytes)</span><br><span class="line">UPDATE src/modules/user/user.module.ts (241 bytes)</span><br><span class="line">➜  nest-base git:(02.module) ✗</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、上面我们说过<code>app.controller.ts</code>和<code>app.service.ts</code>是非必须文件,我们删除的时候要注意在<code>app.module.ts</code>中也要删除依赖引入</p>
</li>
<li><p>4、在<code>user.controller.ts</code>中添加一个访问用户列表的方法</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserService &#125; <span class="keyword">from</span> <span class="string">'./user.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'user'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserController &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> readonly userService: UserService,</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @Get([path])当前的path会拼接到@Controller('user')到里面user的路径后面，不写就表示为空的</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="comment">// userList这个方法名随便自己定义,要见文思意就可以</span></span><br><span class="line">  <span class="keyword">async</span> userList(): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>[]&gt; &#123;</span><br><span class="line">    <span class="comment">// 控制层访问服务层的userList方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.userService.userList();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、在<code>user.service.ts</code>中定义与控制器对接的<code>userList</code>方法(模拟返回点数据)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserService &#123;</span><br><span class="line">  <span class="keyword">async</span> userList(): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="number">0</span>,</span><br><span class="line">        name: <span class="string">'张三'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="number">1</span>,</span><br><span class="line">        name: <span class="string">'李四'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>6、运行项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run start:dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>7、浏览器上直接访问<code>localhost:3000/user</code></p>
</li>
</ul>
<h2 id="四、自定义模块之间的相互引入"><a href="#四、自定义模块之间的相互引入" class="headerlink" title="四、自定义模块之间的相互引入"></a>四、自定义模块之间的相互引入</h2><ul>
<li><p>1、在上面的基础上创建一个日志模块及服务</p>
<blockquote>
<p>官方在<code>@nestjs/common</code>中提供了一个<code>Logger</code>日志模块,我们这仅仅是做演示模块之间的引入 </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  ➜  nest-base git:(02.module) nest g mo modules/log          </span><br><span class="line">  CREATE src/modules/log/log.module.ts (80 bytes)</span><br><span class="line">  UPDATE src/app.module.ts (265 bytes)</span><br><span class="line">  ➜  nest-base git:(02.module) ✗ nest g s modules/log --no-spec</span><br><span class="line">  CREATE src/modules/log/log.service.ts (87 bytes)</span><br><span class="line">  UPDATE src/modules/log/log.module.ts (151 bytes)</span><br><span class="line">  ➜  nest-base git:(02.module) ✗ </span><br><span class="line">  ``` </span><br><span class="line"></span><br><span class="line">* 2、在`log.service.ts`中定义日志打印的方法</span><br><span class="line"></span><br><span class="line">  ```typescript</span><br><span class="line">  import &#123; Injectable &#125; from '@nestjs/common';</span><br><span class="line"></span><br><span class="line">  @Injectable()</span><br><span class="line">  export class LogService &#123;</span><br><span class="line"></span><br><span class="line">    log(str: string): void &#123;</span><br><span class="line">      console.log(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error(str: string): void &#123;</span><br><span class="line">      console.log(str);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、我们要在<code>LogModule</code>模块以为的模块使用到上面定义的<code>log</code>和<code>error</code>方法就要在<code>LogModule</code>中对外暴露出去</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LogService &#125; <span class="keyword">from</span> <span class="string">'./log.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  providers: [LogService],</span><br><span class="line">  <span class="comment">// 这里是以数组的方式,表示一个模块里面可以对外暴露多个</span></span><br><span class="line">  exports: [LogService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> LogModule &#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、在<code>app.module.ts</code>中删除<code>LogModule</code>的引入</p>
</li>
<li><p>5、在<code>user.module.ts</code>中引入<code>LogModule</code>模块</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="comment">// 引入LogModule</span></span><br><span class="line">  imports: [LogModule],</span><br><span class="line">  controllers: [UserController],</span><br><span class="line">  providers: [UserService]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserModule &#123; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>6、在<code>user.controller.ts</code>中使用<code>LogService</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">'user'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserController &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> readonly logService: LogService,</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="keyword">async</span> userList(): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>[]&gt; &#123;</span><br><span class="line">    <span class="comment">// 控制层访问服务层的userList方法</span></span><br><span class="line">    <span class="keyword">this</span>.logService.log(<span class="string">'运行了userList控制器'</span>);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>7、<font color="#f00">注意点:如果要使用模块外的提供者而为引入模块会提示错误或者引入的模块中没有外暴露出来的提供者</font></p>
<p><img src="https://images.gitee.com/uploads/images/2020/0829/192027_4708ffc5_1808543.png" alt="输入图片说明" title="module01.png"></p>
</li>
<li><p>8、<a href="https://github.com/kuangshp/nest-book-code/tree/02.module" target="_blank" rel="noopener">代码参考</a></p>
</li>
</ul>
<h2 id="五、全局模块"><a href="#五、全局模块" class="headerlink" title="五、全局模块"></a>五、全局模块</h2><ul>
<li><p>1、<a href="https://docs.nestjs.com/modules#global-modules" target="_blank" rel="noopener">参考文档</a></p>
</li>
<li><p>2、全局模块的定义方式</p>
<blockquote>
<p>在普通模块的上面添加一个<code>@Global()</code>的装饰器,对外暴露想暴露的提供者,就那么简单</p>
</blockquote>
</li>
<li><p>3、为什么要使用全局模块</p>
<blockquote>
<p>项目比较大,一些公共模块,会在项目很多个模块中需要引入的情况下</p>
</blockquote>
</li>
<li><p>4、如果使用全局模块</p>
<ul>
<li>直接在<code>app.module.ts</code>中的<code>import</code>中添加全局模块</li>
<li>在需要使用全局模块中暴露的提供者,不需要在该模块中<code>import</code></li>
<li>直接依赖注入就可以</li>
</ul>
</li>
<li><p>5、<a href="https://github.com/kuangshp/nest-book-code/tree/03.global_module" target="_blank" rel="noopener">代码参考地址</a></p>
</li>
</ul>
<h2 id="六、动态模块"><a href="#六、动态模块" class="headerlink" title="六、动态模块"></a>六、动态模块</h2><ul>
<li><p>1、官网地址<a href="https://docs.nestjs.com/modules#dynamic-modules" target="_blank" rel="noopener">地址一</a>和<a href="https://docs.nestjs.com/fundamentals/dynamic-modules" target="_blank" rel="noopener">地址二</a></p>
</li>
<li><p>2、使用动态模块的场景</p>
<blockquote>
<p>需要向模块中传递参数的情况下，我们就要使用动态模块,不传递参数就使用普通模块即可</p>
</blockquote>
</li>
<li><p>3、动态模块中常见的2个静态方法,选择用其中一个就可以</p>
<ul>
<li><code>register()</code></li>
<li><code>forRoot()</code></li>
</ul>
</li>
</ul>
<h4 id="使用register静态方法创建一个日志的动态模块"><a href="#使用register静态方法创建一个日志的动态模块" class="headerlink" title="使用register静态方法创建一个日志的动态模块"></a>使用<code>register</code>静态方法创建一个日志的动态模块</h4><ul>
<li><p>1、定义模块</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, DynamicModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LogService &#125; <span class="keyword">from</span> <span class="string">'./log.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> LogModule &#123;</span><br><span class="line">  <span class="comment">// register函数中可以接收外部传递过来的变量,或者对象</span></span><br><span class="line">  <span class="keyword">static</span> register(prefix: <span class="built_in">string</span>): DynamicModule &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="keyword">module</span>: LogModule,</span><br><span class="line">      providers: [</span><br><span class="line">        LogService,</span><br><span class="line">        // 使用useValue的方式在模块中注入一个变量,可以理解为在该模块中注入了别的模块,只是注入的方式不是采用import</span><br><span class="line">        // 而是采用模块调用静态方法的方式</span><br><span class="line">        &#123;</span><br><span class="line">          provide: <span class="string">'PREFIX'</span>,</span><br><span class="line">          useValue: prefix</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 动态模块一样的也要对外暴露出去</span></span><br><span class="line">      exports: [LogService]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<ul>
<li><p>2、在日志中使用当前模块提供的变量</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, Inject &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> LogService &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(<span class="string">'PREFIX'</span>) <span class="keyword">private</span> readonly prefix: <span class="built_in">string</span>, <span class="comment">// 依赖注入的方式</span></span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  log(str: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.prefix&#125;</span>-<span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>3、在<code>user.module.ts</code>使用动态模块</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    LogModule.register(<span class="string">'user'</span>)</span><br><span class="line">  ],</span><br><span class="line">  controllers: [UserController]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserModule &#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、控制器上使用和之前一样的使用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">'user'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserController &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> readonly logService: LogService,</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  hello(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.logService.log(<span class="string">'hello的控制器'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello word'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、<a href="https://github.com/kuangshp/nest-book-code/tree/04.dynamic_module/nest-base" target="_blank" rel="noopener">参考代码</a></p>
</li>
</ul>
<h4 id="使用forRoot静态方法的方式创建一个日志模块"><a href="#使用forRoot静态方法的方式创建一个日志模块" class="headerlink" title="使用forRoot静态方法的方式创建一个日志模块"></a>使用<code>forRoot</code>静态方法的方式创建一个日志模块</h4><ul>
<li>1、使用方式和<code>register</code>一样的</li>
<li>2、两者之间的区别<a href="https://stackoverflow.com/questions/59358741/are-there-any-differences-between-using-forroot-or-register-when-creating-a" target="_blank" rel="noopener">网上也没具体介绍</a></li>
<li>3、<a href="https://github.com/kuangshp/nest-book-code/tree/04.dynamic_module_02/nest-base" target="_blank" rel="noopener">参考代码</a></li>
</ul>
<h2 id="七、解决模块之间的循环依赖"><a href="#七、解决模块之间的循环依赖" class="headerlink" title="七、解决模块之间的循环依赖"></a>七、解决模块之间的循环依赖</h2><ul>
<li><p>1、<a href="https://docs.nestjs.com/fundamentals/circular-dependency#module-forward-reference" target="_blank" rel="noopener">官方文档</a></p>
</li>
<li><p>2、比较常见的场景</p>
<blockquote>
<p>用户模块和授权模块,登录用户登录了，我们要给该用户授权(就依赖了授权模块),授权模块又要根据用户信息来授权(依赖了用户模块),这样就造成一个循环依赖的关系</p>
</blockquote>
</li>
<li><p>3、创建用户模块和授权模块,并且创建对应的服务与暴露出去</p>
</li>
<li><p>4、在用户的控制器中注入授权的服务</p>
</li>
<li><p>5、在授权的服务层注入用户的服务</p>
</li>
<li><p>6、直接提示错误,并且提示你错误解决参考地址<br><img src="https://images.gitee.com/uploads/images/2020/0829/192049_cbee883e_1808543.png" alt="输入图片说明" title="module02.png"></p>
</li>
<li><p>7、我们在相互引入模块的地方采用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imports: [forwardRef(<span class="function"><span class="params">()</span> =&gt;</span> AuthModule)],</span><br></pre></td></tr></table></figure></li>
<li><p>8、<a href="https://github.com/kuangshp/nest-book-code/tree/05.module/nest-base" target="_blank" rel="noopener">参考代码</a></p>
</li>
</ul>
<h2 id="八、官方提供的module使用方式见各自文档"><a href="#八、官方提供的module使用方式见各自文档" class="headerlink" title="八、官方提供的module使用方式见各自文档"></a>八、<a href="https://github.com/nestjs" target="_blank" rel="noopener">官方提供的<code>module</code></a>使用方式见各自文档</h2><h1 id="nestjs生命周期钩子函数-使用频率低"><a href="#nestjs生命周期钩子函数-使用频率低" class="headerlink" title="nestjs生命周期钩子函数(使用频率低)"></a><center>nestjs生命周期钩子函数(<font color="#f00">使用频率低</font>)</center></h1><h2 id="一、官网地址-2"><a href="#一、官网地址-2" class="headerlink" title="一、官网地址"></a>一、<a href="https://docs.nestjs.com/fundamentals/lifecycle-events" target="_blank" rel="noopener">官网地址</a></h2><h2 id="二、常见的生命周期"><a href="#二、常见的生命周期" class="headerlink" title="二、常见的生命周期"></a>二、常见的生命周期</h2><p>所有应用程序元素都有一个由<code>Nest</code>管理的生命周期。<code>Nest</code>提供了生命周期钩子，提供了对关键生命时刻的可见性，以及在关键时刻发生时采取行动的能力。</p>
<ul>
<li>1、常见的生命周期钩子函数</li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>描素</th>
</tr>
</thead>
<tbody><tr>
<td><code>onModuleInit()</code></td>
<td>初始化主模块后调用</td>
</tr>
<tr>
<td><code>onApplicationBootstrap()</code></td>
<td>在应用程序完全启动并引导后调用</td>
</tr>
<tr>
<td><code>onModuleDestroy()</code></td>
<td>在Nest销毁主模块(<code>app.close()</code>方法之前进行清理)</td>
</tr>
<tr>
<td><code>beforeApplicationShutdown()</code></td>
<td>响应系统信号(当应用程序关闭时，例如<code>SIGTERM</code>)</td>
</tr>
</tbody></table>
<ul>
<li><p>2、使用方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, OnModuleInit &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UsersService <span class="keyword">implements</span> OnModuleInit &#123;</span><br><span class="line">  onModuleInit() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`The module has been initialized.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://suzhihui.github.io/2020/08/30/nestjs-%E4%B8%80/" data-id="ckowlt6nh000x5cu549vk45xa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nestjs/" rel="tag">nestjs</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/09/01/nestjs-%E4%BA%8C/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          nextjs(二)
        
      </div>
    </a>
  
  
    <a href="/2020/08/25/mysql-%E4%B8%80/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">mysql</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nestjs/" rel="tag">nestjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84/" rel="tag">前端架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%85%A7%E6%9D%A5%E5%AE%A2/" rel="tag">慧来客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/electron/" style="font-size: 10px;">electron</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nestjs/" style="font-size: 17.5px;">nestjs</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/vue/" style="font-size: 12.5px;">vue</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84/" style="font-size: 15px;">前端架构</a> <a href="/tags/%E6%85%A7%E6%9D%A5%E5%AE%A2/" style="font-size: 10px;">慧来客</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 20px;">正则表达式</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/22/electron/">electron</a>
          </li>
        
          <li>
            <a href="/2021/04/12/git%E9%AB%98%E7%BA%A7/">git 高级</a>
          </li>
        
          <li>
            <a href="/2021/01/13/npm-%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84%E4%BF%AE%E6%94%B9/">npm 全局安装路径修改</a>
          </li>
        
          <li>
            <a href="/2020/09/09/nestjs-%E4%BA%94/">nestjs(五)</a>
          </li>
        
          <li>
            <a href="/2020/09/08/nestjs-%E5%9B%9B/">nestjs(四)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 laosu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>